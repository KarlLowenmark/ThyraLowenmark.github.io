---
import PageLayout from '~/layouts/PageLayout.astro';
import { getPermalink } from '~/utils/permalinks';
import { portfolioProjects, getProjectBySlug } from '~/data/portfolio';

export function getStaticPaths() {
  return portfolioProjects.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const project = getProjectBySlug(slug);

if (!project) {
  throw new Error(`Portfolio project not found for slug: ${slug}`);
}

const metadata = { title: project.title, description: project.summary };

// Robust for GitHub Pages base path; works for public/ assets everywhere
const assetUrl = (p: string) => `${import.meta.env.BASE_URL}${String(p).replace(/^\/+/, '')}`;
---

<PageLayout metadata={metadata}>
  <article class="mx-auto max-w-4xl px-6 py-14 md:py-20">
    <a class="text-sm underline" href={getPermalink('portfolio')}>Back to portfolio</a>

    <h1 class="mt-4 text-4xl font-semibold md:text-5xl">{project.title}</h1>

    <div class="mt-4 flex flex-wrap gap-2">
      {project.tags.map((t) => <span class="rounded-full border px-3 py-1 text-xs opacity-90">{t}</span>)}
    </div>

    <p class="mt-5 text-lg opacity-90">{project.summary}</p>

    <div class="mt-10 rounded-3xl border p-4">
      <img
        class="aspect-[16/10] w-full rounded-2xl object-cover"
        src={assetUrl(project.coverImage)}
        alt={`${project.title} — hero`}
        loading="lazy"
      />
    </div>

    <section class="mt-12 grid gap-6 md:grid-cols-3">
      <div class="rounded-3xl border p-6">
        <p class="text-sm uppercase tracking-widest opacity-70">Goal</p>
        <p class="mt-2 text-sm opacity-90">{project.goal}</p>
      </div>
      <div class="rounded-3xl border p-6">
        <p class="text-sm uppercase tracking-widest opacity-70">Scope</p>
        <p class="mt-2 text-sm opacity-90">{project.scope}</p>
      </div>
      <div class="rounded-3xl border p-6">
        <p class="text-sm uppercase tracking-widest opacity-70">Outcome</p>
        <p class="mt-2 text-sm opacity-90">{project.outcome}</p>
      </div>
    </section>

    <section class="mt-12">
      <h2 class="text-2xl font-semibold">What changed</h2>
      <ul class="mt-4 list-disc space-y-2 pl-5 text-sm opacity-90">
        {project.whatChanged.map((item) => <li>{item}</li>)}
      </ul>
    </section>

    <section class="mt-12">
      <h2 class="text-2xl font-semibold">Gallery</h2>
      <div class="mt-6 grid gap-4 sm:grid-cols-2">
        {project.galleryImages.map((src) => (
          <img
            class="aspect-[4/3] w-full rounded-2xl object-cover"
            src={assetUrl(src)}
            alt={`${project.title} — image`}
            loading="lazy"
          />
        ))}
      </div>
    </section>

    <section class="mt-14 rounded-3xl border p-8">
      <h2 class="text-2xl font-semibold">Want a plan for your space?</h2>
      <p class="mt-3 text-sm opacity-90">
        Share photos and goals—Thyra will recommend the right service and a clear next step.
      </p>
      <a
        class="mt-6 inline-block rounded-2xl bg-black px-6 py-3 font-medium text-white hover:opacity-90"
        href={getPermalink('contact')}
      >
        Book a consultation
      </a>
    </section>
  </article>
</PageLayout>
